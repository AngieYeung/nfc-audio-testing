<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Audio Player</title>
    <link rel="stylesheet" href="style.css">
    <meta name="description" content="扫码即可播放专属音频">
</head>
<body>
    <div class="player-container">
        <h1 id="audio-title">Audio Player</h1>
        
        <div class="controls">
            <button id="playBtn">▶ Play</button>
            <button id="pauseBtn">⏸ Stop</button>
        </div>
        
        <div class="volume-control">
            <label for="volume">Volume:</label>
            <input type="range" id="volume" min="0" max="1" step="0.1" value="0.7">
        </div>
        
        <div class="progress-container" id="progressContainer">
            <div class="progress-bar" id="progressBar"></div>
        </div>
        
        <div class="audio-info">
            <span id="currentTime">0:00</span> / <span id="duration">0:00</span>
        </div>
        
        <div class="status" id="status">Ready</div>
        
        <div class="share-section">
            <p>Share this audio:</p>
            <input type="text" id="shareUrl" readonly>
            <button id="copyBtn">Copy URL</button>
        </div>
    </div>

    <audio id="audioPlayer"></audio>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // 获取DOM元素
            const audioPlayer = document.getElementById('audioPlayer');
            const playBtn = document.getElementById('playBtn');
            const pauseBtn = document.getElementById('pauseBtn');
            const statusText = document.getElementById('status');
            const volumeControl = document.getElementById('volume');
            const progressContainer = document.getElementById('progressContainer');
            const progressBar = document.getElementById('progressBar');
            const currentTimeEl = document.getElementById('currentTime');
            const durationEl = document.getElementById('duration');
            const audioTitle = document.getElementById('audio-title');
            const shareUrlInput = document.getElementById('shareUrl');
            const copyBtn = document.getElementById('copyBtn');

            // 从URL获取音频参数
            const urlParams = new URLSearchParams(window.location.search);
            let audioFile = urlParams.get('audio') || 'audio1.mp3'; // 默认音频
            
            // 设置音频源
            audioPlayer.src = `audio/${audioFile}`;
            
            // 设置页面标题
            document.title = audioFile.replace('.mp3', '') + ' - Audio Player';
            audioTitle.textContent = audioFile.replace('.mp3', '').replace(/-/g, ' ');
            
            // 设置分享链接
            const currentUrl = window.location.href.split('?')[0] + `?audio=${audioFile}`;
            shareUrlInput.value = currentUrl;
            
            // 复制链接功能
            copyBtn.addEventListener('click', function() {
                shareUrlInput.select();
                document.execCommand('copy');
                statusText.textContent = "URL copied/链接已复制";
                setTimeout(() => {
                    statusText.textContent = audioPlayer.paused ? 
                        "Ready/准备就绪" : "Playing/播放中...";
                }, 2000);
            });
            
            // 尝试自动播放
            audioPlayer.volume = volumeControl.value;
            const tryAutoplay = () => {
                audioPlayer.play()
                    .then(_ => {
                        statusText.textContent = "Playing/播放中...";
                    })
                    .catch(error => {
                        statusText.textContent = "Click Play/请点击播放";
                        console.log("Autoplay blocked:", error);
                    });
            };
            
            // 页面交互后尝试自动播放
            document.body.addEventListener('click', tryAutoplay, { once: true });
            
            // 播放按钮事件
            playBtn.addEventListener('click', function() {
                audioPlayer.play();
                statusText.textContent = "Playing/播放中...";
            });
            
            // 暂停按钮事件
            pauseBtn.addEventListener('click', function() {
                audioPlayer.pause();
                statusText.textContent = "Paused/已暂停";
            });
            
            // 音量控制
            volumeControl.addEventListener('input', function() {
                audioPlayer.volume = this.value;
            });
            
            // 更新进度条
            audioPlayer.addEventListener('timeupdate', updateProgress);
            
            // 点击进度条跳转
            progressContainer.addEventListener('click', setProgress);
            
            // 音频加载后显示总时长
            audioPlayer.addEventListener('loadedmetadata', function() {
                durationEl.textContent = formatTime(audioPlayer.duration);
                tryAutoplay(); // 再次尝试自动播放
            });
            
            // 音频结束事件
            audioPlayer.addEventListener('ended', function() {
                statusText.textContent = "Ended/播放结束";
                progressBar.style.width = '0%';
                currentTimeEl.textContent = '0:00';
            });
            
            // 辅助函数：更新时间显示
            function updateProgress() {
                const { duration, currentTime } = audioPlayer;
                const progressPercent = (currentTime / duration) * 100;
                progressBar.style.width = `${progressPercent}%`;
                currentTimeEl.textContent = formatTime(currentTime);
            }
            
            // 辅助函数：设置播放进度
            function setProgress(e) {
                const width = this.clientWidth;
                const clickX = e.offsetX;
                const duration = audioPlayer.duration;
                audioPlayer.currentTime = (clickX / width) * duration;
            }
            
            // 辅助函数：格式化时间
            function formatTime(seconds) {
                const mins = Math.floor(seconds / 60);
                const secs = Math.floor(seconds % 60);
                return `${mins}:${secs < 10 ? '0' : ''}${secs}`;
            }
        });
    </script>
</body>
</html>